<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iwhalecloud.retail.report.mapper.ReportStoreMapper">

    <select id="ListReportStSale" parameterType="com.iwhalecloud.retail.report.dto.request.ReportStSaleDaoReq"
            resultType="com.iwhalecloud.retail.report.dto.response.ReportStSaleDaoResp">
       SELECT 
			 a.PARTNER_NAME AS partnerName,	
			 a.PARTNER_CODE AS partnerCode,	
			 a.BUSINESS_ENTITY_NAME AS businessEntityName,
			 a.type_id AS typeName,		
			 a.stock_warning AS stockWarning,	
			 a.date AS DATE,		
			 a.CITY_ID AS cityId,		
			 a.COUNTY_ID AS countyId,		
			 a.PRODUCT_BASE_NAME AS productBaseName,	
			 a.BRAND_NAME AS brandName,		
			 a.PRICE_LEVEL AS priceLevel,		
			 SUM(a.TOTAL_IN_NUM) AS totalInNum,	
			 SUM(a.TOTAL_OUT_NUM) AS totalOutNum,	
			 SUM(a.PURCHASE_NUM) AS purchaseNum,	
			 SUM(a.MANUAL_NUM) AS manualNum,		
			 SUM(a.TRANS_IN_NUM) AS transInNum,	
			 SUM(a.PURCHASE_AMOUNT) AS purchaseAmount,	
			 SUM(a.SELL_NUM) AS sellNum,		
			 SUM(a.SELL_AMOUNT) AS sellAmount,		
			 SUM(a.UNCONTRACT_NUM) AS uncontractNum,	
			 SUM(a.CONTRACT_NUM) AS contractNum,	
			 SUM(a.REGISTER_NUM) AS registerNum,	
			 SUM(a.TRANS_OUT_NUM) AS transOutNum,	
			 SUM(a.RETURN_NUM) AS returnNum,		
			 a.WEEK_AVG_SELL_NUM AS weekAvgSellNum,	
			 a.STOCK_AMOUNT AS stockAmount,	
			 a.STOCK_NUM AS stockNum,		
			 a.TURNOVER_RATE as turnoverRate,				
			 '' AS actOfProvinces,   
			 '' as ProActRate
			FROM RPT_PARTNER_OPERATING_DAY a
	where 1=1
	<if test="req.dateStart!=null and req.dateStart!=''">
		and DATE_FORMAT(a.DATE,'%Y-%m-%d') &gt;= str_to_date(#{req.dateStart}, '%Y-%m-%d')
	</if>
	<if test="req.dateStart!=null and req.dateStart!=''">
			and DATE_FORMAT(a.DATE,'%Y-%m-%d') &lt;= str_to_date(#{req.dateStart}, '%Y-%m-%d')
	</if>
	<if test="req.brandName!=null and req.brandName!=''">
		and a.brand_id=#{req.brandName}
	</if>
	<if test="req.productBaseName!=null and req.productBaseName!=''">
		and a.PRODUCT_BASE_ID=#{req.productBaseName}
	</if>
	<if test="req.partnerName!=null and req.partnerName!=''">
		and a.PARTNER_NAME like CONCAT(CONCAT('%',#{req.partnerName}),'%')
	</if>
	<if test="req.partnerCode!=null and req.partnerCode!=''">
		and a.PARTNER_CODE = #{req.partnerCode}
	</if>
	<if test="req.businessEntityName!=null and req.businessEntityName!=''">
		and a.BUSINESS_ENTITY_NAME like CONCAT(CONCAT('%',#{req.businessEntityName}),'%')
	</if>
    <if test="req.cityId!=null and req.cityId!=''">
		and a.CITY_ID =#{req.cityId}
	</if>
	<if test="req.countyId!=null and req.countyId!=''">
		and a.COUNTY_ID =#{req.countyId}
	</if>
	<if test="req.typeId!=null and req.typeId!=''">  
		and a.TYPE_ID=#{req.typeId}
	</if>
	<if test="req.stockWarning!=null and req.stockWarning!=''">  
		and a.stock_warning=#{req.stockWarning}
	</if>
	GROUP BY partnerCode,productBaseName
  </select>
</mapper>
